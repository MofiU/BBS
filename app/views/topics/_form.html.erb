<%= simple_form_for @topic do |f|%>
  <ul class="nav nav-pills nav-justified" style="margin-bottom: 20px;">
    <li role="presentation" class="btn btn-primary">Edit</li>
    <li role="presentation" class="btn btn-default">Preview</li>
  </ul>

  <%= f.input :node_id, wrapper: :vertical_input_group, label: false do %>
    <div class="input-group-btn">
      <%= f.button :button, '请选择节点...', type: :button, id: 'node-selector-button', 'data-toggle' => "modal", 'data-target' => '#node-selector' %>
    </div><!-- /btn-group -->
    <%= f.input :title, label: false, placeholder: '在这里填写标题' %>
  <% end %>

    <div class="row">
      <div class="col-md-6">
        <%= f.input :body, label: false, input_html: {"oninput" => "this.editor.update()", style: "height: 500px;"} %>
      </div>
      <div id="preview" class="col-md-6" style="word-break: break-all;"> </div>
    </div>
  <div class="row">
    <div class="col-sm-3">
      <%= f.button :submit, class: 'btn btn-primary btn-block' %>
    </div>
    <div class="col-sm-2">
    <%= link_to 'Cancel', topics_path, class: 'btn btn-default btn-block' %>
    </div>
  </div>
<% end %>


<!-- Modal -->
<div class="modal fade" id="node-selector" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title"><strong>选择话题节点</strong></h4>
      </div>
      <div class="modal-body">
        <div class="index-sections panel panel-default">
          <div class="panel-body">
            <div class="row node-list">
              <div class="node media">
                <label class="media-left">Ruby</label>
                <span class="nodes media-body">
                    <span class="name"><%= link_to 'sss', 'www.baidu.com', :onclick => "alert('Please no!')" %></span>
                    <span class="name"><a title="JRuby" data-id="54" href="/topics/node54">JRuby</a></span>
                    <span class="name"><a title="部署" data-id="44" href="/topics/node44">部署</a></span>
                    <span class="name"><a title="重构" data-id="29" href="/topics/node29">重构</a></span>
                    <span class="name"><a title="Ruby" data-id="1" href="/topics/node1">Ruby</a></span>
                    <span class="name"><a title="Testing" data-id="37" href="/topics/node37">Testing</a></span>
                    <span class="name"><a title="Sinatra" data-id="43" href="/topics/node43">Sinatra</a></span>
                    <span class="name"><a title="Rails" data-id="2" href="/topics/node2">Rails</a></span>
                    <span class="name"><a title="开源项目" data-id="47" href="/topics/node47">开源项目</a></span>
                    <span class="name"><a title="Gem" data-id="3" href="/topics/node3">Gem</a></span>
                    <span class="name"><a title="RVM/Rbenv" data-id="45" href="/topics/node45">RVM/Rbenv</a></span>
                    <span class="name"><a title="mRuby" data-id="66" href="/topics/node66">mRuby</a></span>
                    <span class="name"><a title="求职" data-id="64" href="/topics/node64">求职</a></span>
                    <span class="name"><a title="招聘" data-id="25" href="/topics/node25">招聘</a></span>
                </span>
              </div>
            </div>
          </div>
      </div>
    </div>
  </div>
</div>


<script>
$(document).ready(function () {
  // function autosize(textarea) {
  //   $(textarea).height(500); // temporarily shrink textarea so that scrollHeight returns content height when content does not fill textarea
  //   $(textarea).height($(textarea).prop("scrollHeight"));
  // }
  // $(document).on("input", "textarea", function() {
  //   autosize(this);
  // });
  // $("textarea").each(function () {
  //   autosize(this);
  // });

  function Editor(input, preview) {
    this.update = function () {
      preview.innerHTML = markdown.toHTML(input.value);
    };
    input.editor = this;
    this.update();
  }
  var $ = function (id) { return document.getElementById(id); };
  new Editor($("topic_body"), $("preview"));
});
</script>
